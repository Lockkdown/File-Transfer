# á»¨ng dá»¥ng chuyá»ƒn táº­p tin (Java Client/Server File Transfer)

## ğŸ“š Äá»“ Ã¡n mÃ´n há»c: Láº­p trÃ¬nh máº¡ng mÃ¡y tÃ­nh

### ThÃ´ng tin nhÃ³m

| STT | Há» vÃ  tÃªn | MSSV |
|:---:|-----------|------|
| 1 | TrÆ°Æ¡ng HoÃ ng PhÃºc | 2280602486 |
| 2 | NgÃ´ XuÃ¢n Háº¡o | 2280600867 |

---

## ğŸ“ MÃ´ táº£ dá»± Ã¡n

á»¨ng dá»¥ng truyá»n file qua **TCP sockets** vá»›i cÃ¡c tÃ­nh nÄƒng:
- ÄÄƒng kÃ½ / ÄÄƒng nháº­p / QuÃªn máº­t kháº©u
- Upload / Download file
- Chia sáº» file vá»›i quyá»n (OWNER / EDIT / VIEW)
- Quáº£n lÃ½ version file
- Demo vá»›i Wireshark capture

---

## ğŸ—ï¸ Kiáº¿n trÃºc há»‡ thá»‘ng

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           DRIVE-LITE ARCHITECTURE                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Client A   â”‚                                    â”‚   Client B   â”‚
    â”‚   (JavaFX)   â”‚                                    â”‚   (JavaFX)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                                   â”‚
           â”‚  TCP Socket                         TCP Socket    â”‚
           â”‚  Port 9000                          Port 9000     â”‚
           â”‚                                                   â”‚
           â–¼                                                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                        JAVA TCP SERVER                          â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚   Accept    â”‚  â”‚   Client    â”‚  â”‚      Request            â”‚  â”‚
    â”‚  â”‚    Loop     â”‚â”€â–¶â”‚   Handler  â”‚â”€â–¶â”‚      Dispatcher         â”‚  â”‚
    â”‚  â”‚             â”‚  â”‚  (Thread)   â”‚  â”‚                         â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                â”‚                â”‚
    â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
    â”‚         â–¼                  â–¼                   â–¼        â–¼       â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚    Auth    â”‚    â”‚    File    â”‚    â”‚  Share   â”‚ â”‚ Version â”‚   â”‚
    â”‚  â”‚  Handlers  â”‚    â”‚  Handlers  â”‚    â”‚ Handlers â”‚ â”‚ Handler â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â”‚
    â”‚        â”‚                 â”‚                â”‚            â”‚        â”‚
    â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
    â”‚                              â”‚                                  â”‚
    â”‚                              â–¼                                  â”‚
    â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
    â”‚                    â”‚   Repository    â”‚                          â”‚
    â”‚                    â”‚     Layer       â”‚                          â”‚
    â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                           â”‚
                    â–¼                           â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚   SQL Server    â”‚        â”‚   File System   â”‚
           â”‚   (Metadata)    â”‚        â”‚   (Storage)     â”‚
           â”‚                 â”‚        â”‚                 â”‚
           â”‚  - Users        â”‚        â”‚  ./storage/     â”‚
           â”‚  - Sessions     â”‚        â”‚    â”œâ”€â”€ file1/   â”‚
           â”‚  - Files        â”‚        â”‚    â”‚   â””â”€â”€ v1   â”‚
           â”‚  - Permissions  â”‚        â”‚    â””â”€â”€ file2/   â”‚
           â”‚  - Versions     â”‚        â”‚        â””â”€â”€ v1   â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Luá»“ng xá»­ lÃ½ chÃ­nh

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PROTOCOL FRAME FORMAT                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚  4 bytes     â”‚              N bytes                                â”‚    â”‚
â”‚   â”‚  (length)    â”‚           (JSON payload)                            â”‚    â”‚
â”‚   â”‚  Big-endian  â”‚                                                     â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â”‚   VÃ­ dá»¥: LOGIN request                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚  00 00 00 45 â”‚ {"type":"LOGIN","data":{"email":"a@b.com",...}}     â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Upload Flow

```
    Client                                Server
      â”‚                                     â”‚
      â”‚  1. UPLOAD_BEGIN                    â”‚
      â”‚  {fileName, fileSize, sha256}       â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
      â”‚                                     â”‚
      â”‚  2. READY                           â”‚
      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
      â”‚                                     â”‚
      â”‚  3. Raw file bytes                  â”‚
      â”‚  (exactly fileSize bytes)           â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
      â”‚                                     â”‚
      â”‚  4. UPLOAD_OK                       â”‚
      â”‚  {fileId, versionNumber}            â”‚
      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
      â”‚                                     â”‚
```

### Permission Model (ACL)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PERMISSION MATRIX                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Action     â”‚  OWNER  â”‚  EDIT   â”‚  VIEW   â”‚  NONE   â”‚          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  View/List  â”‚   âœ…    â”‚   âœ…    â”‚   âœ…    â”‚   âŒ    â”‚          â”‚
â”‚  Download   â”‚   âœ…    â”‚   âœ…    â”‚   âœ…    â”‚   âŒ    â”‚          â”‚
â”‚  Upload Ver â”‚   âœ…    â”‚   âœ…    â”‚   âŒ    â”‚   âŒ    â”‚          â”‚
â”‚  Share      â”‚   âœ…    â”‚   âŒ    â”‚   âŒ    â”‚   âŒ    â”‚          â”‚
â”‚  Revoke     â”‚   âœ…    â”‚   âŒ    â”‚   âŒ    â”‚   âŒ    â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš™ï¸ Prerequisites (YÃªu cáº§u)

- **Java 17+** (khuyáº¿n nghá»‹ JDK 21)
- **Maven 3.6+**
- **SQL Server 2019+** (hoáº·c SQL Server Express)
- **SQL Server Management Studio (SSMS)** Ä‘á»ƒ cháº¡y migration script

### Kiá»ƒm tra version

```powershell
java -version    # Pháº£i >= 17
mvn -version     # Pháº£i >= 3.6
```

## Setup

### 1. Clone vÃ  cáº¥u hÃ¬nh

```powershell
# Clone repo
git clone <repo-url>
cd File_Transfer

# Copy file cáº¥u hÃ¬nh máº«u
copy .env.example .env

# Sá»­a .env vá»›i thÃ´ng tin SQL Server cá»§a báº¡n
notepad .env
```

### 2. Táº¡o Database

Má»Ÿ SSMS, káº¿t ná»‘i Ä‘áº¿n SQL Server, cháº¡y:

```sql
CREATE DATABASE FileTransfer;
GO
```

### 3. Cháº¡y Migration Script

Trong SSMS:
1. Chá»n database `FileTransfer`
2. File â†’ Open â†’ `src/server/src/main/resources/db/V1__init_schema.sql`
3. Execute (F5)

### 4. Build Project

```powershell
cd src
mvn clean install
```

## Run

### Start Server

```powershell
cd src/server
mvn exec:java "-Dexec.mainClass=com.drivelite.server.ServerMain"
```

### Start Client

```powershell
cd src/client
mvn javafx:run
```

## Project Structure

```
File_Transfer/
â”œâ”€â”€ .env.example        # Cáº¥u hÃ¬nh máº«u
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ pom.xml         # Parent POM
â”‚   â”œâ”€â”€ common/         # Shared code (protocol, DTOs)
â”‚   â”œâ”€â”€ server/         # TCP Server + DB
â”‚   â””â”€â”€ client/         # JavaFX Client
â””â”€â”€ README.md
```

## Configuration (.env)

| Variable | Description | Default |
|----------|-------------|---------|
| `DB_HOST` | SQL Server hostname | localhost |
| `DB_PORT` | SQL Server port | 1433 |
| `DB_NAME` | Database name | FileTransfer |
| `DB_USER` | SQL Server username | â€” |
| `DB_PASSWORD` | SQL Server password | â€” |
| `SERVER_PORT` | TCP server port | 9000 |
| `MAX_FILE_SIZE` | Max upload size (bytes) | 524288000 (500MB) |

## Test Database Connection

```powershell
cd src/server
mvn exec:java "-Dexec.mainClass=com.drivelite.server.db.DbConnectionTest"
```

## Troubleshooting

### "JAVA_HOME not set"
```powershell
$env:JAVA_HOME = "C:\Program Files\Java\jdk-21"
```

### "Login failed for user"
- Kiá»ƒm tra SQL Server Authentication Ä‘Ã£ báº­t
- Kiá»ƒm tra username/password trong `.env`

### "Cannot open database"
- Cháº¡y `CREATE DATABASE FileTransfer` trong SSMS

### "Connection refused"
- Báº­t TCP/IP trong SQL Server Configuration Manager
- Má»Ÿ port 1433 trong Windows Firewall

## Demo vá»›i Wireshark

1. Má»Ÿ Wireshark, chá»n interface máº¡ng (Ethernet/Wi-Fi)
2. Filter: `tcp.port == 9000`
3. Start capture
4. Cháº¡y Server vÃ  Client
5. Thá»±c hiá»‡n cÃ¡c thao tÃ¡c (login, upload, download)
6. Stop capture vÃ  phÃ¢n tÃ­ch packets

## ğŸ“– TÃ i liá»‡u tham kháº£o

- [Oracle Java Networking Tutorial](https://docs.oracle.com/javase/tutorial/networking/)
- [JavaFX Documentation](https://openjfx.io/openjfx-docs/)
- [Microsoft JDBC Driver for SQL Server](https://learn.microsoft.com/en-us/sql/connect/jdbc/)
- [Wireshark User Guide](https://www.wireshark.org/docs/wsug_html/)

---

## ğŸ“„ License

MIT License - Äá»“ Ã¡n há»c táº­p
